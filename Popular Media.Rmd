---
title: "Popuar Media"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    theme: yeti
---

```{r setup, include=FALSE}

# Loading Libraries
library(flexdashboard)
library(tidyverse)
library(highcharter)
library(gt)
library(htmltools)
library(viridis)
```

```{r}
# Importing the book sale data
books <- read.csv("data_sets/Books.csv")

# Remove duplicates
books <- books %>% 
  distinct(Name, .keep_all = TRUE) %>% 
  rename(User_Rating = 'User.Rating')

# Importing music data
music <- read_csv("data_sets/Music.csv")

music <- music %>% 
  rename(weeks_on_board = 'weeks-on-board',
         peak_rank = 'peak-rank') %>% 
  select(-'last-week')

# clean the data

music <- music %>% 
  group_by(song, artist) %>% 
  summarise(weeks_on_board = max(weeks_on_board))
```



Books
=======================================================================

Column {.tabset .tabset-fade data-width=650}
-----------------------------------------------------------------------

### Most Popular Authors  {data-height=800}

```{r}
custom_colors = viridis::mako(n = 15)

books %>% 
  group_by(Author) %>% 
  summarise(Reviews = sum(Reviews)) %>% 
  arrange(desc(Reviews)) %>% 
  head(15) %>% 
  hchart('column', hcaes(x  = Author, y = Reviews, color = custom_colors)) %>% 
  hc_add_theme(hc_theme_google()) %>% 
  hc_tooltip(pointFormat = '<b>Number of Reviews: </b> {point.y} <br>') %>% 
  hc_title(text = 'Most Popuar Authors from 2009 to 2019',
           style = list(fontSize = '25px', fontWeight = 'bold')) %>% 
  hc_subtitle(text = 'By Number of Reviews',
              style = list(fontSize = '16px')) 
  
```

### Most Popular Books {data-height=800}

```{r}

custom_colors = viridis::plasma(n = 15)

# Most popular books by reviews

books %>% 
  arrange(desc(Reviews)) %>% 
  head(15) %>% 
  hchart('bar', hcaes(x = Name, y = Reviews, color = custom_colors))%>% 
  hc_add_theme(hc_theme_google()) %>% 
  hc_tooltip(pointFormat = '<b>Number of Reviews: </b> {point.y} <br>') %>% 
  hc_title(text = 'Most Popuar Books from 2009 to 2019',
           style = list(fontSize = '25px', fontWeight = 'bold')) %>% 
  hc_subtitle(text = 'By Number of Reviews',
              style = list(fontSize = '16px')) 
```

Column {data-width=350}
-----------------------------------------------------------------------

### {.no-padding}

```{r}
custom_colors = viridis::mako(n = 2)

# most common genre pie chart

books %>% group_by(Genre) %>% 
  summarise(count = n()) %>% 
  hchart('pie', hcaes(x = Genre, y = count, color = custom_colors))%>% 
  hc_add_theme(hc_theme_google()) %>% 
  hc_tooltip(pointFormat = '<b>Proportion: </b> {point.percentage:,2f}%') %>%
  hc_title(text = 'Most Common Genre from 2009 to 2019',
           style = list(fontSize = '15px', fontWeight = 'bold')) 
``` 

### {.no-padding}

```{r}

# data table 

books_2 <- books %>% 
  filter(User_Rating >= 4.9) %>% 
  arrange(desc(Reviews)) %>% 
  select(Name, Author)

# HTML table chart

div(style = 'height:600px; overflow-y:scroll', gt(books_2) %>% 
      tab_header(title = md('Best Books from 2009 to 2019'),
                 subtitle = md('By Users Rating')) %>% 
      opt_table_font(font = list(google_font('Chivo'), default_fonts())) %>% 
      tab_style(location = cells_column_labels(columns = everything()),
                style = list(cell_borders(sides = 'bottom', 
                                          weight = px(2)), 
                             cell_text(weight = 'bold'))) %>% 
      tab_options(table.font.size = px(12L),
                  table.border.top.style = 'none',
                  column_labels.border.bottom.width = 2,
                  table_body.border.top.style = 'none',
                  data_row.padding = px(3))
    )
```


Songs {data-orientation=rows}
============================================================================

## Row 1 {data-height=100}
-----------------------------------------------------------------------

## Row 2 {data-height=600}
----------------------------------------------------------------------- 

### Most Popular Songs on the Billboard "The Hot 100" {data-width=500 data-height=600}

```{r fig.height=5}
# Colors
custom_colors <- viridis::mako(n = 20)

# Most popular songs by weeks on board
music %>% 
  arrange(desc(weeks_on_board)) %>% 
  head(20) %>% 
  hchart('lollipop', hcaes(x = song, y = weeks_on_board, color = custom_colors)) %>% 
  hc_add_theme(hc_theme_google()) %>% 
  hc_tooltip(pointFormat = '<b>Number of Weeks on Board: </b> {point.y} <br>') %>% 
  hc_yAxis(title = list(text = 'Weeks on Board')) %>% 
  hc_xAxis(title = list(text = 'Songs')) %>% 
  hc_title(text = 'Most Popular Songs',
           style = list(fontSize = '25px', fontWeight = 'bold')) %>% 
  hc_subtitle(text = 'By Number of Weeks on Board',
              style = list(fontSize = '16px'))
```


### Most Popular Artists on the Billboard "The Hot 100" {data-width=500 data-height=600}

```{r fig.height=5}
# Colors
custom_colors <- viridis::plasma(n = 10)

# Most popular artists by weeks on board
music %>% 
  group_by(artist) %>% 
  summarise(weeks_on_board = sum(weeks_on_board)) %>% 
  arrange(desc(weeks_on_board)) %>% 
  head(10) %>% 
  hchart('pie', hcaes(x = artist, y = weeks_on_board, color = custom_colors)) %>% 
  hc_add_theme(hc_theme_google()) %>% 
  hc_tooltip(pointFormat = '<b>Number of Weeks on Board: </b> {point.y} <br>') %>% 
  hc_title(text = 'Most Popular Artists',
           style = list(fontSize = '25px', fontWeight = 'bold')) %>% 
  hc_subtitle(text = 'By Number of Weeks on Board',
              style = list(fontSize = '16px'))
```


